<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Supabase Player</title>

  <style>
    body {
      background: #f5f5f5;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #log {
      background: #111;
      color: #0f0;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-size: 13px;
      white-space: pre-wrap;
      border-radius: 6px;
    }
  </style>
</head>

<body>

  <h2>Supabase Media Player</h2>

  <!-- Contenedor del reproductor -->
  <video id="player" controls width="600" style="display:none;"></video>
  <audio id="player-audio" controls style="display:none;"></audio>

  <h3>Consola interna</h3>
  <div id="log"></div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js";

    // ---------------------------------------------------------
    // CONFIGURACI√ìN SUPABASE
    // ---------------------------------------------------------
    const SUPABASE_URL = "https://czppmgrvffpuoiaoduxx.supabase.co";
    const SUPABASE_KEY = "sb_publishable_Qf5GqauZh78nEiS950bVew_FzihB41o";

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    function log(msg) {
      const logDiv = document.getElementById("log");
      logDiv.textContent += msg + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(msg);
    }

    // ---------------------------------------------------------
    // FUNCI√ìN PRINCIPAL: CARGAR Y REPRODUCIR ARCHIVO
    // ---------------------------------------------------------
    async function loadMedia() {
      log("Inicializando conexi√≥n con Supabase...");

      const bucketName = "videos";  // cambiar seg√∫n tu bucket
      const fileName = "demo.mp4";  // cambiar seg√∫n tu archivo

      log("Solicitando URL p√∫blica al bucket '" + bucketName + "' ...");

      // Nueva sintaxis correcta del SDK
      const { data, error } = supabase
        .storage
        .from(bucketName)
        .getPublicUrl(fileName);

      if (error) {
        log("‚ùå Error obteniendo URL: " + error.message);
        alert("Error: No se pudo cargar el archivo.");
        return;
      }

      const publicUrl = data?.publicUrl;

      if (!publicUrl) {
        log("‚ùå No se gener√≥ URL p√∫blica. Verifica el bucket y el archivo.");
        alert("Error: archivo no encontrado en el bucket.");
        return;
      }

      log("‚úî Archivo encontrado:");
      log(publicUrl);

      // Detectar tipo seg√∫n extensi√≥n
      if (fileName.endsWith(".mp4") || fileName.endsWith(".webm")) {
        const video = document.getElementById("player");
        video.src = publicUrl;
        video.style.display = "block";
        video.play();
        log("üé¨ Reproduciendo video...");
      } 
      else if (fileName.endsWith(".mp3") || fileName.endsWith(".wav")) {
        const audio = document.getElementById("player-audio");
        audio.src = publicUrl;
        audio.style.display = "block";
        audio.play();
        log("üéµ Reproduciendo audio...");
      } 
      else {
        log("‚ö† Tipo de archivo no soportado: " + fileName);
      }
    }

    loadMedia();
  </script>

</body>
</html>
